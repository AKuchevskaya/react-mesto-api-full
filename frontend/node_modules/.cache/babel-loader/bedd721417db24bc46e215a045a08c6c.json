{"ast":null,"code":"import _defineProperty from\"/Users/alenakuchevskaya/Desktop/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _toConsumableArray from\"/Users/alenakuchevskaya/Desktop/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/alenakuchevskaya/Desktop/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/alenakuchevskaya/Desktop/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from\"react\";import{Switch,Route,useHistory,Redirect}from\"react-router-dom\";import Header from\"./Header\";import*as Auth from\"../utils/Auth.js\";import ProtectedRoute from\"./ProtectedRoute\";import Register from\"./Register\";import Login from\"./Login\";import Main from\"./Main\";import Footer from\"./Footer\";import InfoTooltip from\"./InfoTooltip\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup\";import DeleteCardPopup from\"./DeleteCardPopup\";import ImagePopup from\"./ImagePopup\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import api from\"../utils/Api\";import success from\"../../src/images/ok.svg\";import error from\"../../src/images/error.svg\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEditAvatarPopupOpen=_useState2[0],setEditAvatarPopupOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isEditProfilePopupOpen=_useState4[0],setEditProfilePopupOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isAddPlacePopupOpen=_useState6[0],setAddPlacePopupOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isQwestionPopupOpen=_useState8[0],setQwestionPopupOpen=_useState8[1];var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),currentUser=_useState10[0],setCurrentUser=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),cards=_useState12[0],setCards=_useState12[1];var _useState13=useState({}),_useState14=_slicedToArray(_useState13,2),selectedCard=_useState14[0],setSelectedCard=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),removedCardId=_useState16[0],setRemovedCardId=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),loggedIn=_useState18[0],setLoggedIn=_useState18[1];var _useState19=useState(),_useState20=_slicedToArray(_useState19,2),userData=_useState20[0],setUserData=_useState20[1];var history=useHistory();var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),isTooltipOpen=_useState22[0],setTooltipOpen=_useState22[1];var _useState23=useState({image:success,message:\"Вы успешно зарегистрировались!\"}),_useState24=_slicedToArray(_useState23,2),tooltip=_useState24[0],setTooltip=_useState24[1];var _useState25=useState({}),_useState26=_slicedToArray(_useState25,2),errorMessage=_useState26[0],setErrorMessage=_useState26[1];var _useState27=useState(true),_useState28=_slicedToArray(_useState27,2),buttonState=_useState28[0],setButtonState=_useState28[1];function tokenCheck(){if(localStorage.getItem(\"email\")){var token=localStorage.getItem(\"token\");Auth.getContent(token).then(function(res){var _res$data=res.data,_id=_res$data._id,email=_res$data.email;setLoggedIn(true);setUserData(_objectSpread(_objectSpread({},userData),{},{_id:_id,email:email}));}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u043F\\u0440\\u043E\\u0432\\u0435\\u0440\\u043A\\u0438 \\u0442\\u043E\\u043A\\u0435\\u043D\\u0430...: \".concat(err));});}}useEffect(function(){tokenCheck();},[]);useEffect(function(){if(loggedIn){history.push(\"/\");}},[loggedIn]);useEffect(function(){if(loggedIn){Promise.all([//в Promise.all передаем массив промисов которые нужно выполнить\napi.getInitialCards(),api.getProfile()]).then(function(_ref){var _ref2=_slicedToArray(_ref,2),cards=_ref2[0],currentUser=_ref2[1];setCards(cards);setCurrentUser(currentUser);}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u043F\\u043E\\u043B\\u0443\\u0447\\u0435\\u043D\\u0438\\u044F \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445 \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044F.....: \".concat(err));});}},[loggedIn]);function handleCardLike(card){// Снова проверяем, есть ли уже лайк на этой карточке\n// const isLiked = card.likes.some((user) => user._id === currentUser._id);\nvar isLiked=card.likes.some(function(user){return user===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\napi.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(item){return item._id===card._id?newCard:item;});});}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u043E\\u0431\\u0440\\u0430\\u0431\\u043E\\u0442\\u043A\\u0438 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445 \\u043A\\u0430\\u0440\\u0442\\u0438\\u043D\\u043A\\u0438.....: \".concat(err));});}function handleCardDelete(card){api.deleteCard(removedCardId).then(function(){setCards(function(state){return state.filter(function(item){return item._id!==removedCardId;});});closeAllPopups();}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0443\\u0434\\u0430\\u043B\\u0435\\u043D\\u0438\\u044F \\u043A\\u0430\\u0440\\u0442\\u043E\\u0447\\u043A\\u0438.....: \".concat(err));});}function handleEditAvatarClick(){setEditAvatarPopupOpen(true);}function handleEditProfileClick(){setEditProfilePopupOpen(true);}function handleAddPlaceClick(){setAddPlacePopupOpen(true);}function handleButtonDeleteClick(card){setQwestionPopupOpen(true);setRemovedCardId(card);}function handleCardClick(card){setSelectedCard({isOpened:true,name:card.name,link:card.link});}function handleUpdateAvatar(_ref3){var avatar=_ref3.avatar;api.editAvatar(avatar).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u043E\\u0431\\u043D\\u043E\\u0432\\u043B\\u0435\\u043D\\u0438\\u044F \\u0430\\u0432\\u0430\\u0442\\u0430\\u0440\\u0430.....: \".concat(err));});}function handleUpdateUser(_ref4){var name=_ref4.name,about=_ref4.about;api.editProfile(name,about).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u043E\\u0431\\u043D\\u043E\\u0432\\u043B\\u0435\\u043D\\u0438\\u044F \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445 \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044F.....: \".concat(err));});}function handleAddPlaceSubmit(_ref5){var name=_ref5.name,link=_ref5.link;api.addCard(name,link).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0434\\u043E\\u0431\\u0430\\u0432\\u043B\\u0435\\u043D\\u0438\\u044F \\u043D\\u043E\\u0432\\u043E\\u0439 \\u043A\\u0430\\u0440\\u0442\\u043E\\u0447\\u043A\\u0438.....: \".concat(err));});}function closeAllPopups(){setEditAvatarPopupOpen(false);setEditProfilePopupOpen(false);setAddPlacePopupOpen(false);setQwestionPopupOpen(false);setSelectedCard(_objectSpread(_objectSpread({},selectedCard),{},{isOpened:false}));setTooltipOpen(false);}function handleRegister(_ref6){var email=_ref6.email,password=_ref6.password;return Auth.register(email,password).then(function(res){console.log(res);var email=res.email;setUserData(_objectSpread(_objectSpread({},userData),{},{email:email}));setTooltipOpen(true);setTooltip({image:success,message:\"Вы успешно зарегистрировались!\"});history.push(\"/signin\");}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0430\\u0446\\u0438\\u0438...: \".concat(err));setTooltipOpen(true);setTooltip({image:error,message:\"Что-то пошло не так! Попробуйте ещё раз.\"});});}function handleLogin(_ref7){var email=_ref7.email,password=_ref7.password;return Auth.authorize(email,password).then(function(data){if(data.token){setLoggedIn(true);localStorage.setItem(\"token\",data.token);tokenCheck();}}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0430\\u0432\\u0442\\u043E\\u0440\\u0438\\u0437\\u0430\\u0446\\u0438\\u0438...: \".concat(err));setTooltipOpen(true);setTooltip({image:error,message:\"Что-то пошло не так! Попробуйте ещё раз.\"});});}function signOut(){localStorage.removeItem(\"token\");setLoggedIn(false);setUserData({_id:\"\",email:\"\"});history.push(\"/signin\");}function checkInputValidity(evt){if(!evt.currentTarget.checkValidity()){setErrorMessage(_objectSpread(_objectSpread({},errorMessage),{},_defineProperty({},evt.target.name,evt.target.validationMessage)));setButtonState(true);}else{setErrorMessage({});setButtonState(false);}}useEffect(function(){setErrorMessage({});setButtonState(true);},[isEditProfilePopupOpen,isAddPlacePopupOpen,isEditAvatarPopupOpen]);return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page__container\",children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,userData:userData,signOut:signOut}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsxs(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,children:[/*#__PURE__*/_jsx(Main,{cards:cards,onCardClick:handleCardClick,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardLike:handleCardLike,onCardButtonDeleteClick:handleButtonDeleteClick}),/*#__PURE__*/_jsx(Footer,{})]}),/*#__PURE__*/_jsx(Route,{path:\"/signup\",children:/*#__PURE__*/_jsx(Register,{handleRegister:handleRegister})}),/*#__PURE__*/_jsx(Route,{path:\"/signin\",children:/*#__PURE__*/_jsx(Login,{handleLogin:handleLogin,tokenCheck:tokenCheck})}),/*#__PURE__*/_jsx(Route,{children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/signin\"})})]}),/*#__PURE__*/_jsx(InfoTooltip,{name:\"answer\",isOpen:isTooltipOpen,onClose:closeAllPopups,tooltip:tooltip.image,message:tooltip.message}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar,onValidate:checkInputValidity,buttonState:buttonState,errorMessage:errorMessage}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser,onValidate:checkInputValidity,buttonState:buttonState,errorMessage:errorMessage}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit,onValidate:checkInputValidity,buttonState:buttonState,errorMessage:errorMessage}),/*#__PURE__*/_jsx(DeleteCardPopup,{isOpen:isQwestionPopupOpen,onClose:closeAllPopups,handleCardDelete:handleCardDelete}),/*#__PURE__*/_jsx(ImagePopup,{selectedCard:selectedCard,onClose:closeAllPopups})]})});}export default App;","map":{"version":3,"sources":["/Users/alenakuchevskaya/Desktop/react-mesto-api-full/frontend/src/components/App.js"],"names":["useState","useEffect","Switch","Route","useHistory","Redirect","Header","Auth","ProtectedRoute","Register","Login","Main","Footer","InfoTooltip","EditProfilePopup","EditAvatarPopup","AddPlacePopup","DeleteCardPopup","ImagePopup","CurrentUserContext","api","success","error","App","isEditAvatarPopupOpen","setEditAvatarPopupOpen","isEditProfilePopupOpen","setEditProfilePopupOpen","isAddPlacePopupOpen","setAddPlacePopupOpen","isQwestionPopupOpen","setQwestionPopupOpen","currentUser","setCurrentUser","cards","setCards","selectedCard","setSelectedCard","removedCardId","setRemovedCardId","loggedIn","setLoggedIn","userData","setUserData","history","isTooltipOpen","setTooltipOpen","image","message","tooltip","setTooltip","errorMessage","setErrorMessage","buttonState","setButtonState","tokenCheck","localStorage","getItem","token","getContent","then","res","data","_id","email","catch","err","console","log","push","Promise","all","getInitialCards","getProfile","handleCardLike","card","isLiked","likes","some","user","changeLikeCardStatus","newCard","state","map","item","handleCardDelete","deleteCard","filter","closeAllPopups","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleButtonDeleteClick","handleCardClick","isOpened","name","link","handleUpdateAvatar","avatar","editAvatar","handleUpdateUser","about","editProfile","handleAddPlaceSubmit","addCard","handleRegister","password","register","handleLogin","authorize","setItem","signOut","removeItem","checkInputValidity","evt","currentTarget","checkValidity","target","validationMessage"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\nimport { Switch, Route, useHistory, Redirect } from \"react-router-dom\";\nimport Header from \"./Header\";\nimport * as Auth from \"../utils/Auth.js\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport Register from \"./Register\";\nimport Login from \"./Login\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport DeleteCardPopup from \"./DeleteCardPopup\";\nimport ImagePopup from \"./ImagePopup\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport api from \"../utils/Api\";\nimport success from \"../../src/images/ok.svg\";\nimport error from \"../../src/images/error.svg\";\n\nfunction App() {\n  const [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = useState(false);\n  const [isEditProfilePopupOpen, setEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setAddPlacePopupOpen] = useState(false);\n  const [isQwestionPopupOpen, setQwestionPopupOpen] = useState(false);\n\n  const [currentUser, setCurrentUser] = useState({});\n  const [cards, setCards] = useState([]);\n  const [selectedCard, setSelectedCard] = useState({});\n  const [removedCardId, setRemovedCardId] = useState(null);\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [userData, setUserData] = useState();\n  const history = useHistory();\n  const [isTooltipOpen, setTooltipOpen] = useState(false);\n  const [tooltip, setTooltip] = useState({\n    image: success,\n    message: \"Вы успешно зарегистрировались!\",\n  });\n\n  const [errorMessage, setErrorMessage] = useState({});\n  const [buttonState, setButtonState] = useState(true);\n\n  function tokenCheck() {\n    if (localStorage.getItem(\"email\")) {\n      let token = localStorage.getItem(\"token\");\n      Auth.getContent(token)\n        .then((res) => {\n          const { _id, email } = res.data;\n          setLoggedIn(true);\n          setUserData({ ...userData, _id, email });\n        })\n        .catch((err) => {\n          console.log(`Ошибка проверки токена...: ${err}`);\n        });\n    }\n  }\n\n  useEffect(() => {\n    tokenCheck();\n  }, []);\n  useEffect(() => {\n    if (loggedIn) {\n      history.push(\"/\");\n    }\n  }, [loggedIn]);\n\n  useEffect(() => {\n    if (loggedIn) {\n      Promise.all([\n        //в Promise.all передаем массив промисов которые нужно выполнить\n        api.getInitialCards(),\n        api.getProfile(),\n      ])\n        .then(([cards, currentUser]) => {\n          setCards(cards);\n          setCurrentUser(currentUser);\n        })\n        .catch((err) => {\n          console.log(`Ошибка получения данных пользователя.....: ${err}`);\n        });\n    }\n  }, [loggedIn]);\n\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    // const isLiked = card.likes.some((user) => user._id === currentUser._id);\n    const isLiked = card.likes.some((user) => user === currentUser._id);\n\n    // Отправляем запрос в API и получаем обновлённые данные карточки\n    api\n      .changeLikeCardStatus(card._id, !isLiked)\n      .then((newCard) => {\n        setCards((state) =>\n          state.map((item) => (item._id === card._id ? newCard : item))\n        );\n      })\n      .catch((err) => {\n        console.log(`Ошибка обработки данных картинки.....: ${err}`);\n      });\n  }\n\n  function handleCardDelete(card) {\n    api\n      .deleteCard(removedCardId)\n      .then(() => {\n        setCards((state) =>\n          state.filter((item) => item._id !== removedCardId)\n        );\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(`Ошибка удаления карточки.....: ${err}`);\n      });\n  }\n\n  function handleEditAvatarClick() {\n    setEditAvatarPopupOpen(true);\n  }\n  function handleEditProfileClick() {\n    setEditProfilePopupOpen(true);\n  }\n  function handleAddPlaceClick() {\n    setAddPlacePopupOpen(true);\n  }\n  function handleButtonDeleteClick(card) {\n    setQwestionPopupOpen(true);\n    setRemovedCardId(card);\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard({\n      isOpened: true,\n      name: card.name,\n      link: card.link,\n    });\n  }\n  function handleUpdateAvatar({ avatar }) {\n    api\n      .editAvatar(avatar)\n      .then((res) => {\n        setCurrentUser(res);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(`Ошибка обновления аватара.....: ${err}`);\n      });\n  }\n  function handleUpdateUser({ name, about }) {\n    api\n      .editProfile(name, about)\n      .then((res) => {\n        setCurrentUser(res);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(`Ошибка обновления данных пользователя.....: ${err}`);\n      });\n  }\n\n  function handleAddPlaceSubmit({ name, link }) {\n    api\n      .addCard(name, link)\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(`Ошибка добавления новой карточки.....: ${err}`);\n      });\n  }\n  function closeAllPopups() {\n    setEditAvatarPopupOpen(false);\n    setEditProfilePopupOpen(false);\n    setAddPlacePopupOpen(false);\n    setQwestionPopupOpen(false);\n    setSelectedCard({ ...selectedCard, isOpened: false });\n    setTooltipOpen(false);\n  }\n  function handleRegister({ email, password }) {\n    return Auth.register(email, password)\n      .then((res) => {\n        console.log(res);\n        const { email } = res;\n        setUserData({ ...userData, email });\n        setTooltipOpen(true);\n        setTooltip({\n          image: success,\n          message: \"Вы успешно зарегистрировались!\",\n        });\n        history.push(\"/signin\");\n      })\n      .catch((err) => {\n        console.log(`Ошибка регистрации...: ${err}`);\n        setTooltipOpen(true);\n\n        setTooltip({\n          image: error,\n          message: \"Что-то пошло не так! Попробуйте ещё раз.\",\n        });\n      });\n  }\n\n  function handleLogin({ email, password }) {\n    return Auth.authorize(email, password)\n      .then((data) => {\n        if (data.token) {\n          setLoggedIn(true);\n          localStorage.setItem(\"token\", data.token);\n          tokenCheck();\n        }\n      })\n      .catch((err) => {\n        console.log(`Ошибка авторизации...: ${err}`);\n        setTooltipOpen(true);\n        setTooltip({\n          image: error,\n          message: \"Что-то пошло не так! Попробуйте ещё раз.\",\n        });\n      });\n  }\n\n  function signOut() {\n    localStorage.removeItem(\"token\");\n    setLoggedIn(false);\n    setUserData({ _id: \"\", email: \"\" });\n    history.push(\"/signin\");\n  }\n\n  function checkInputValidity(evt) {\n    if (!evt.currentTarget.checkValidity()) {\n      setErrorMessage({\n        ...errorMessage,\n        [evt.target.name]: evt.target.validationMessage,\n      });\n      setButtonState(true);\n    } else {\n      setErrorMessage({});\n      setButtonState(false);\n    }\n  }\n\n  useEffect(() => {\n    setErrorMessage({});\n    setButtonState(true);\n  }, [isEditProfilePopupOpen, isAddPlacePopupOpen, isEditAvatarPopupOpen]);\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className=\"page__container\">\n        <Header loggedIn={loggedIn} userData={userData} signOut={signOut} />\n        <Switch>\n          <ProtectedRoute exact path=\"/\" loggedIn={loggedIn}>\n            <Main\n              cards={cards}\n              onCardClick={handleCardClick}\n              onEditAvatar={handleEditAvatarClick}\n              onEditProfile={handleEditProfileClick}\n              onAddPlace={handleAddPlaceClick}\n              onCardLike={handleCardLike}\n              onCardButtonDeleteClick={handleButtonDeleteClick}\n            />\n            <Footer />\n          </ProtectedRoute>\n\n          <Route path=\"/signup\">\n            <Register handleRegister={handleRegister} />\n          </Route>\n          <Route path=\"/signin\">\n            <Login handleLogin={handleLogin} tokenCheck={tokenCheck} />\n          </Route>\n          <Route>\n            {loggedIn ? <Redirect to=\"/\" /> : <Redirect to=\"/signin\" />}\n          </Route>\n        </Switch>\n        <InfoTooltip\n          name=\"answer\"\n          isOpen={isTooltipOpen}\n          onClose={closeAllPopups}\n          tooltip={tooltip.image}\n          message={tooltip.message}\n        />\n        <EditAvatarPopup\n          isOpen={isEditAvatarPopupOpen}\n          onClose={closeAllPopups}\n          onUpdateAvatar={handleUpdateAvatar}\n          onValidate={checkInputValidity}\n          buttonState={buttonState}\n          errorMessage={errorMessage}\n        />\n        <EditProfilePopup\n          isOpen={isEditProfilePopupOpen}\n          onClose={closeAllPopups}\n          onUpdateUser={handleUpdateUser}\n          onValidate={checkInputValidity}\n          buttonState={buttonState}\n          errorMessage={errorMessage}\n        />\n\n        <AddPlacePopup\n          isOpen={isAddPlacePopupOpen}\n          onClose={closeAllPopups}\n          onAddPlace={handleAddPlaceSubmit}\n          onValidate={checkInputValidity}\n          buttonState={buttonState}\n          errorMessage={errorMessage}\n        />\n\n        <DeleteCardPopup\n          isOpen={isQwestionPopupOpen}\n          onClose={closeAllPopups}\n          handleCardDelete={handleCardDelete}\n        />\n\n        <ImagePopup selectedCard={selectedCard} onClose={closeAllPopups} />\n      </div>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}